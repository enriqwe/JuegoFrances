<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apprends le Fran√ßais ! üá´üá∑</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Fredoka', sans-serif;
            background-color: #f0f9ff;
            user-select: none;
        }
        .card {
            perspective: 1000px;
            cursor: pointer;
        }
        .card-inner {
            transition: transform 0.6s;
            transform-style: preserve-3d;
            position: relative;
            height: 100px;
        }
        .card.flipped .card-inner {
            transform: rotateY(180deg);
        }
        .card-front, .card-back {
            backface-visibility: hidden;
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 1rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
        }
        .card-back {
            transform: rotateY(180deg);
            background-color: white;
        }
        .bounce-in {
            animation: bounceIn 0.5s cubic-bezier(0.36, 0, 0.66, -0.56) 0s 1 normal none;
        }
        @keyframes bounceIn {
            0% { transform: scale(0); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center p-4">

    <!-- Header -->
    <header class="w-full max-w-4xl flex justify-between items-center mb-6">
        <h1 class="text-3xl font-bold text-blue-600">üá´üá∑ Apprends le Fran√ßais !</h1>
        <div id="score-badge" class="bg-yellow-400 px-4 py-2 rounded-full font-bold text-yellow-900 shadow-sm">
            Estrellas: <span id="star-count">0</span> ‚≠ê
        </div>
    </header>

    <!-- Main Container -->
    <main id="game-container" class="w-full max-w-4xl bg-white rounded-3xl p-6 shadow-xl min-h-[500px] flex flex-col">
        <!-- Contenido din√°mico -->
    </main>

    <!-- Modal de Feedback -->
    <div id="feedback-overlay" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50 p-4">
        <div class="bg-white rounded-2xl p-8 max-w-sm w-full text-center shadow-2xl scale-0 transition-transform duration-300" id="feedback-content">
            <div id="feedback-emoji" class="text-6xl mb-4">üéâ</div>
            <h2 id="feedback-title" class="text-2xl font-bold mb-2">¬°Genial!</h2>
            <div id="feedback-text" class="text-gray-600 mb-6 whitespace-pre-line">Has acertado.</div>
            <button id="feedback-button" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-xl font-bold w-full">Continuar</button>
        </div>
    </div>

    <script>
        // --- VOCABULARIO ---
        const vocabulary = [
            { id: 1, fr: "Triangle", es: "Tri√°ngulo", emoji: "üî∫", cat: "forme" },
            { id: 2, fr: "Cercle", es: "C√≠rculo", emoji: "‚ö™", cat: "forme" },
            { id: 3, fr: "Carr√©", es: "Cuadrado", emoji: "üü¶", cat: "forme" },
            { id: 4, fr: "Rectangle", es: "Rect√°ngulo", emoji: "‚ñ≠", cat: "forme" },
            { id: 20, fr: "√âtoile", es: "Estrella", emoji: "‚≠ê", cat: "forme" },
            { id: 21, fr: "Coeur", es: "Coraz√≥n", emoji: "‚ù§Ô∏è", cat: "forme" },
            { id: 22, fr: "Losange", es: "Rombo", emoji: "üí†", cat: "forme" },
            { id: 23, fr: "Hexagone", es: "Hex√°gono", emoji: "‚¨°", cat: "forme" },
            { id: 24, fr: "Ovale", es: "√ìvalo", emoji: "‚¨≠", cat: "forme" },
            { id: 25, fr: "Pentagone", es: "Pent√°gono", emoji: "‚¨†", cat: "forme" },
            { id: 5, fr: "Cochon", es: "Cerdo", emoji: "üê∑", cat: "animal" },
            { id: 6, fr: "Vache", es: "Vaca", emoji: "üêÆ", cat: "animal" },
            { id: 7, fr: "Mouton", es: "Oveja", emoji: "üêë", cat: "animal" },
            { id: 8, fr: "Taureau", es: "Toro", emoji: "üêÇ", cat: "animal" },
            { id: 9, fr: "Ch√®vre", es: "Cabra", emoji: "üêê", cat: "animal" },
            { id: 10, fr: "Cheval", es: "Caballo", emoji: "üê¥", cat: "animal" },
            { id: 11, fr: "Lapin", es: "Conejo", emoji: "üê∞", cat: "animal" },
            { id: 12, fr: "Chien", es: "Perro", emoji: "üê∂", cat: "animal" },
            { id: 13, fr: "Chat", es: "Gato", emoji: "üê±", cat: "animal" },
            { id: 14, fr: "Coq", es: "Gallo", emoji: "üêì", cat: "animal" },
            { id: 15, fr: "Poussins", es: "Pollitos", emoji: "üê•", cat: "animal" },
            { id: 16, fr: "√Çne", es: "Burro", emoji: "ü´è", cat: "animal" },
            { id: 17, fr: "Canard", es: "Pato", emoji: "ü¶Ü", cat: "animal" },
            { id: 18, fr: "Oie", es: "Ganso", emoji: "ü™ø", cat: "animal" },
            { id: 19, fr: "Poisson", es: "Pez", emoji: "üêü", cat: "animal" },
            { id: 26, fr: "Lion", es: "Le√≥n", emoji: "ü¶Å", cat: "animal" },
            { id: 27, fr: "Tigre", es: "Tigre", emoji: "üêØ", cat: "animal" },
            { id: 28, fr: "√âl√©phant", es: "Elefante", emoji: "üêò", cat: "animal" },
            { id: 29, fr: "Girafe", es: "Jirafa", emoji: "ü¶í", cat: "animal" },
            { id: 30, fr: "Singe", es: "Mono", emoji: "üêí", cat: "animal" },
            { id: 31, fr: "Ours", es: "Oso", emoji: "üêª", cat: "animal" },
            { id: 32, fr: "Renard", es: "Zorro", emoji: "ü¶ä", cat: "animal" },
            { id: 33, fr: "Loup", es: "Lobo", emoji: "üê∫", cat: "animal" },
            { id: 34, fr: "Hibou", es: "B√∫ho", emoji: "ü¶â", cat: "animal" },
            { id: 35, fr: "Tortue", es: "Tortuga", emoji: "üê¢", cat: "animal" },
            { id: 36, fr: "Souris", es: "Rat√≥n", emoji: "üê≠", cat: "animal" },
            { id: 37, fr: "Araign√©e", es: "Ara√±a", emoji: "üï∑Ô∏è", cat: "animal" },
            { id: 38, fr: "Panda", es: "Panda", emoji: "üêº", cat: "animal" },
            { id: 39, fr: "Grenouille", es: "Rana", emoji: "üê∏", cat: "animal" },
            { id: 40, fr: "Baleine", es: "Ballena", emoji: "üê≥", cat: "animal" }
        ];

        let stars = 0;
        let gameSession = {
            currentRound: 0,
            maxRounds: 5,
            correctCount: 0,
            type: null
        };

        // --- UTILS ---
        function speak(text) {
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'fr-FR';
            window.speechSynthesis.speak(utterance);
        }

        function shuffle(array) {
            return [...array].sort(() => Math.random() - 0.5);
        }

        function getTranslation(frWord) {
            const item = vocabulary.find(v => v.fr.toLowerCase() === frWord.toLowerCase());
            return item ? item.es : "desconocido";
        }

        function getFullMistakeMessage(correctFr, options) {
            const correctEs = getTranslation(correctFr);
            const others = options.filter(opt => (typeof opt === 'string' ? opt : opt.fr).toLowerCase() !== correctFr.toLowerCase());
            
            let msg = `Era "${correctFr}" (${correctEs}).\n\n`;
            msg += `Significado de las otras palabras:\n`;
            others.forEach(opt => {
                const fr = typeof opt === 'string' ? opt : opt.fr;
                msg += `‚Ä¢ ${fr}: ${getTranslation(fr)}\n`;
            });
            return msg;
        }

        let feedbackTimeout = null;
        function showFeedback(success, title, text, emoji, callback) {
            if (feedbackTimeout) clearTimeout(feedbackTimeout);
            const overlay = document.getElementById('feedback-overlay');
            const content = document.getElementById('feedback-content');
            const btn = document.getElementById('feedback-button');
            
            document.getElementById('feedback-title').innerText = title;
            document.getElementById('feedback-text').innerText = text;
            document.getElementById('feedback-emoji').innerText = emoji || (success ? "üéâ" : "ü§î");
            
            btn.onclick = () => {
                closeFeedback(callback);
            };

            overlay.classList.remove('hidden');
            overlay.classList.add('flex');
            setTimeout(() => content.classList.add('scale-100'), 10);
        }

        function closeFeedback(callback) {
            const overlay = document.getElementById('feedback-overlay');
            const content = document.getElementById('feedback-content');
            content.classList.remove('scale-100');
            
            feedbackTimeout = setTimeout(() => {
                overlay.classList.add('hidden');
                overlay.classList.remove('flex');
                if (callback) callback();
            }, 300);
        }

        function renderHeader(gameTitle) {
            return `
                <div class="flex justify-between items-center mb-4">
                    <div>
                        <h3 class="font-bold text-xl text-blue-600">${gameTitle}</h3>
                        <p class="text-xs text-gray-400">Pregunta ${gameSession.currentRound + 1} de ${gameSession.maxRounds}</p>
                    </div>
                    <button onclick="showMenu()" class="bg-gray-100 px-3 py-1 rounded-lg text-sm hover:bg-gray-200">Salir</button>
                </div>
                <div class="w-full bg-gray-100 h-2 rounded-full mb-6 overflow-hidden">
                    <div class="bg-blue-400 h-full transition-all duration-500" style="width: ${(gameSession.currentRound / gameSession.maxRounds) * 100}%"></div>
                </div>
            `;
        }

        function checkSessionEnd(finalEmoji = "üèÜ") {
            gameSession.currentRound++;
            if (gameSession.currentRound >= gameSession.maxRounds) {
                const total = gameSession.correctCount;
                const bonus = total * 2;
                stars += bonus;
                document.getElementById('star-count').innerText = stars;
                
                setTimeout(() => {
                    showFeedback(
                        true, 
                        "¬°Sesi√≥n terminada!", 
                        `Has acertado ${total} de ${gameSession.maxRounds}. Ganaste ${bonus} estrellas extras.`, 
                        finalEmoji, 
                        showMenu
                    );
                }, 100);
                return true;
            }
            return false;
        }

        // --- MEN√ö ---
        function showMenu() {
            const container = document.getElementById('game-container');
            container.innerHTML = `
                <h2 class="text-2xl font-bold text-center mb-6 text-gray-700 font-fredoka">Elige un Juego</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <button onclick="startMemory()" class="p-4 bg-orange-100 hover:bg-orange-200 rounded-2xl text-left flex items-center gap-4 transition-all hover:scale-[1.01]">
                        <span class="text-3xl">üß†</span>
                        <div>
                            <p class="font-bold text-orange-800">1. Memory Biling√ºe</p>
                            <p class="text-sm text-orange-600">Encuentra parejas de palabras y emojis.</p>
                        </div>
                    </button>
                    <button onclick="initSession('missing')" class="p-4 bg-blue-100 hover:bg-blue-200 rounded-2xl text-left flex items-center gap-4 transition-all hover:scale-[1.01]">
                        <span class="text-3xl">üïµÔ∏è</span>
                        <div>
                            <p class="font-bold text-blue-800">2. ¬øQu√© falta? (5 rondas)</p>
                            <p class="text-sm text-blue-600">Memoriza y descubre el que falta.</p>
                        </div>
                    </button>
                    <button onclick="initSession('fast')" class="p-4 bg-purple-100 hover:bg-purple-200 rounded-2xl text-left flex items-center gap-4 transition-all hover:scale-[1.01]">
                        <span class="text-3xl">‚ö°</span>
                        <div>
                            <p class="font-bold text-purple-800">3. Match R√°pido (5 rondas)</p>
                            <p class="text-sm text-purple-600">¬°S√© veloz antes de que acabe el tiempo!</p>
                        </div>
                    </button>
                    <button onclick="initSession('intruder')" class="p-4 bg-red-100 hover:bg-red-200 rounded-2xl text-left flex items-center gap-4 transition-all hover:scale-[1.01]">
                        <span class="text-3xl">üö´</span>
                        <div>
                            <p class="font-bold text-red-800">4. El Intruso (5 rondas)</p>
                            <p class="text-sm text-red-600">Solo palabras: encuentra la que no encaja.</p>
                        </div>
                    </button>
                    <button onclick="startRace()" class="p-4 bg-yellow-100 hover:bg-yellow-200 rounded-2xl text-left flex items-center gap-4 transition-all hover:scale-[1.01] md:col-span-2">
                        <span class="text-3xl">üèÅ</span>
                        <div>
                            <p class="font-bold text-yellow-800">5. Carrera de Vocabulario</p>
                            <p class="text-sm text-yellow-600">Llega a la meta con 5 aciertos seguidos.</p>
                        </div>
                    </button>
                </div>
            `;
        }

        function initSession(type) {
            gameSession = { currentRound: 0, maxRounds: 5, correctCount: 0, type: type };
            if (type === 'missing') renderWhatIsMissing();
            if (type === 'fast') renderFastMatch();
            if (type === 'intruder') renderIntruder();
        }

        // --- GAME 1: MEMORY ---
        function startMemory() {
            const container = document.getElementById('game-container');
            const items = shuffle([...vocabulary]).slice(0, 6);
            const cards = shuffle([...items.map(i => ({...i, type: 'emoji'})), ...items.map(i => ({...i, type: 'word'}))]);
            let html = `<div class="flex justify-between items-center mb-4"><h3 class="font-bold text-xl text-orange-600">Memory Biling√ºe</h3><button onclick="showMenu()" class="text-sm bg-gray-100 px-2 py-1 rounded">Cerrar</button></div><div class="grid grid-cols-4 gap-3">`;
            cards.forEach((card, index) => {
                // Aumentado el tama√±o de texto de [10px] a text-base y a√±adido px-1 para palabras largas
                html += `<div id="card-${index}" class="card h-24" onclick="handleMemoryClick(${index}, ${card.id}, '${card.type}', '${card.fr}')"><div class="card-inner w-full h-full"><div class="card-front bg-orange-400 text-white text-2xl font-bold">?</div><div class="card-back text-center p-1 border-2 border-orange-400 font-bold text-base leading-tight flex items-center justify-center overflow-hidden break-words px-1">${card.type === 'emoji' ? `<span class="text-3xl">${card.emoji}</span>` : card.fr}</div></div></div>`;
            });
            container.innerHTML = html + `</div>`;

            let flipped = [], solved = 0;
            window.handleMemoryClick = (idx, id, type, fr) => {
                const el = document.getElementById(`card-${idx}`);
                if (el.classList.contains('flipped') || flipped.length >= 2) return;
                el.classList.add('flipped');
                if (type === 'word') speak(fr);
                flipped.push({idx, id});
                if (flipped.length === 2) {
                    if (flipped[0].id === flipped[1].id) { 
                        solved++; flipped = []; 
                        if (solved === items.length) { 
                            stars += 10; document.getElementById('star-count').innerText = stars; 
                            showFeedback(true, "¬°Bravo!", "Has completado el tablero.", "ü•á", showMenu); 
                        } 
                    }
                    else { setTimeout(() => { document.getElementById(`card-${flipped[0].idx}`).classList.remove('flipped'); document.getElementById(`card-${flipped[1].idx}`).classList.remove('flipped'); flipped = []; }, 1000); }
                }
            };
        }

        // --- GAME 2: ¬øQU√â FALTA? ---
        function renderWhatIsMissing() {
            const container = document.getElementById('game-container');
            const pool = shuffle([...vocabulary]).slice(0, 4);
            const missingIdx = Math.floor(Math.random() * 4);
            const missingItem = pool[missingIdx];

            container.innerHTML = `
                ${renderHeader("¬øQu√© falta?")}
                <p class="text-center text-gray-500 mb-6">Memoriza estos elementos...</p>
                <div class="flex justify-around bg-blue-50 p-6 rounded-2xl mb-8">
                    ${pool.map(item => `<div class="text-center"><div class="text-5xl mb-2 bounce-in">${item.emoji}</div><div class="font-bold text-blue-600 text-xs">${item.fr}</div></div>`).join('')}
                </div>
            `;

            setTimeout(() => {
                const choices = shuffle([missingItem, ...shuffle(vocabulary.filter(v => !pool.includes(v))).slice(0, 2)]);
                container.innerHTML = `
                    ${renderHeader("¬øQu√© falta?")}
                    <p class="text-center text-lg font-bold mb-6">¬øCu√°l ha desaparecido?</p>
                    <div class="flex justify-around bg-gray-100 p-6 rounded-2xl mb-8">
                        ${pool.map((item, i) => i === missingIdx ? `<div class="w-16 h-16 bg-white border-2 border-dashed border-gray-400 rounded-full flex items-center justify-center text-3xl">?</div>` : `<div class="text-5xl opacity-50">${item.emoji}</div>`).join('')}
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        ${choices.map(choice => `<button onclick="handleMissing('${choice.fr}', '${missingItem.fr}', ${JSON.stringify(choices.map(c => c.fr)).replace(/"/g, "'")})" class="bg-white border-2 border-blue-200 p-4 rounded-xl hover:bg-blue-50 font-bold shadow-sm transition-all">${choice.fr}</button>`).join('')}
                    </div>
                `;
            }, 3000);

            window.handleMissing = (choice, correct, allOptions) => {
                const isCorrect = choice === correct;
                if (isCorrect) { gameSession.correctCount++; speak(correct); }
                
                const msg = isCorrect ? `Era ${correct} (${getTranslation(correct)})` : getFullMistakeMessage(correct, allOptions);
                
                showFeedback(
                    isCorrect, 
                    isCorrect ? "¬°Correcto!" : "¬°Oh no!", 
                    msg, 
                    null, 
                    () => { if (!checkSessionEnd("üïµÔ∏è")) renderWhatIsMissing(); }
                );
            };
        }

        // --- GAME 3: MATCH R√ÅPIDO ---
        function renderFastMatch() {
            const container = document.getElementById('game-container');
            const target = vocabulary[Math.floor(Math.random() * vocabulary.length)];
            const options = shuffle([target, ...shuffle(vocabulary.filter(v => v !== target)).slice(0, 2)]);
            
            container.innerHTML = `
                ${renderHeader("Match R√°pido")}
                <div class="flex-1 flex flex-col items-center justify-center">
                    <div class="text-8xl mb-8 bounce-in">${target.emoji}</div>
                    <div class="w-full bg-gray-200 h-4 rounded-full mb-8 overflow-hidden">
                        <div id="timer-bar" class="bg-red-500 h-full w-full transition-all duration-[3000ms] ease-linear"></div>
                    </div>
                    <div class="grid grid-cols-1 w-full gap-4">
                        ${options.map(opt => `<button onclick="handleFastMatch('${opt.fr}', '${target.fr}', ${JSON.stringify(options.map(o => o.fr)).replace(/"/g, "'")})" class="bg-purple-100 hover:bg-purple-200 p-4 rounded-2xl text-xl font-bold text-purple-800 transition-all">${opt.fr}</button>`).join('')}
                    </div>
                </div>
            `;

            setTimeout(() => {
                const bar = document.getElementById('timer-bar');
                if (bar) bar.style.width = '0%';
            }, 50);

            const timerId = setTimeout(() => handleFastMatch(null, target.fr, options.map(o => o.fr)), 3050);

            window.handleFastMatch = (choice, correct, allOptions) => {
                clearTimeout(timerId);
                const isCorrect = (choice === correct);
                if (isCorrect) { gameSession.correctCount++; speak(correct); }
                
                const msg = isCorrect ? `¬°Perfecto! ${correct}` : getFullMistakeMessage(correct, allOptions);
                
                showFeedback(
                    isCorrect,
                    isCorrect ? "¬°R√°pido y bien!" : (choice === null ? "¬°Tiempo!" : "Casi..."),
                    msg,
                    null,
                    () => { if (!checkSessionEnd("‚ö°")) renderFastMatch(); }
                );
            };
        }

        // --- GAME 4: EL INTRUSO ---
        function renderIntruder() {
            const container = document.getElementById('game-container');
            const isAnimalBase = Math.random() > 0.5;
            const baseCat = isAnimalBase ? 'animal' : 'forme';
            const intruderCat = isAnimalBase ? 'forme' : 'animal';
            const group = shuffle(vocabulary.filter(v => v.cat === baseCat)).slice(0, 3);
            const intruder = vocabulary.filter(v => v.cat === intruderCat)[Math.floor(Math.random() * vocabulary.filter(v => v.cat === intruderCat).length)];
            const allItems = shuffle([...group, intruder]);

            container.innerHTML = `
                ${renderHeader("El Intruso")}
                <p class="text-center text-gray-600 mb-8 font-semibold">¬øQu√© palabra NO pertenece al grupo?</p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    ${allItems.map(item => `<button onclick="handleIntruder('${item.fr}', '${intruder.fr}', ${JSON.stringify(allItems.map(i => i.fr)).replace(/"/g, "'")})" class="bg-white border-4 border-gray-100 p-8 rounded-3xl hover:border-red-300 hover:bg-red-50 transition-all text-2xl font-bold text-gray-700">${item.fr}</button>`).join('')}
                </div>
            `;

            window.handleIntruder = (choice, correct, allOptions) => {
                const isCorrect = choice === correct;
                if (isCorrect) { gameSession.correctCount++; speak(correct); }
                
                const msg = isCorrect ? `"${correct}" era el intruso.` : getFullMistakeMessage(correct, allOptions);
                
                showFeedback(
                    isCorrect,
                    isCorrect ? "¬°Lo encontraste!" : "No...",
                    msg,
                    null,
                    () => { if (!checkSessionEnd("üö´")) renderIntruder(); }
                );
            };
        }

        // --- GAME 5: CARRERA ---
        function startRace() {
            gameSession = { currentRound: 0, maxRounds: 5, correctCount: 0, type: 'race' };
            const racePool = shuffle([...vocabulary]).slice(0, 5);
            
            const renderRaceStep = () => {
                const container = document.getElementById('game-container');
                const target = racePool[gameSession.currentRound];
                const options = shuffle([target, ...shuffle(vocabulary.filter(v => v !== target)).slice(0, 2)]);

                container.innerHTML = `
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-bold text-xl text-yellow-600">Carrera de Vocabulario</h3>
                        <button onclick="showMenu()" class="text-sm bg-gray-100 px-2 py-1 rounded">Salir</button>
                    </div>
                    <div class="flex justify-between mb-8 bg-gray-50 p-4 rounded-xl items-center overflow-x-auto no-scrollbar">
                        ${racePool.map((item, i) => `
                            <div class="w-10 h-10 min-w-[40px] rounded-full flex items-center justify-center text-xl transition-all ${i < gameSession.currentRound ? 'bg-green-500' : (i === gameSession.currentRound ? 'bg-yellow-500 animate-bounce scale-110 shadow-md' : 'bg-gray-200')}">
                                ${i < gameSession.currentRound ? '‚úÖ' : item.emoji}
                            </div>
                        `).join('<div class="flex-1 border-t-2 border-dashed border-gray-300 mx-1"></div>')}
                        <div class="flex-1 border-t-2 border-dashed border-gray-300 mx-1"></div>
                        <div class="w-10 h-10 min-w-[40px] bg-blue-600 rounded-full flex items-center justify-center text-xl">üèÅ</div>
                    </div>
                    <div class="text-center mb-6 bg-yellow-50 p-6 rounded-2xl border-2 border-yellow-200">
                        <p class="text-gray-500 mb-1 text-xs uppercase font-bold tracking-widest">Traduce:</p>
                        <h4 class="text-4xl font-bold text-gray-800">${target.es}</h4>
                    </div>
                    <div class="grid grid-cols-1 gap-3">
                        ${options.map(opt => `<button onclick="handleRaceStep('${opt.fr}', '${target.fr}', ${JSON.stringify(options.map(o => o.fr)).replace(/"/g, "'")})" class="bg-white border-2 border-yellow-300 hover:bg-yellow-100 p-4 rounded-xl font-bold text-lg transition-all">${opt.fr}</button>`).join('')}
                    </div>
                `;
            };

            window.handleRaceStep = (choice, correct, allOptions) => {
                if (choice === correct) {
                    gameSession.correctCount++;
                    speak(correct);
                    gameSession.currentRound++;
                    if (gameSession.currentRound >= gameSession.maxRounds) {
                        stars += 15;
                        document.getElementById('star-count').innerText = stars;
                        showFeedback(true, "¬°META!", "¬°Has ganado la carrera impecablemente!", "üèÜ", showMenu);
                    } else {
                        renderRaceStep();
                    }
                } else {
                    const msg = getFullMistakeMessage(correct, allOptions);
                    showFeedback(false, "¬°Tropezaste!", msg + "\nEmpieza de nuevo la carrera.", "ü§ï", showMenu);
                }
            };
            renderRaceStep();
        }

        window.onload = () => {
            showMenu();
            window.speechSynthesis.getVoices();
        };

    </script>
</body>
</html>
<!-- deploy -->
